# example
stages:
  - name: Build something
    # Conditions for stages
    when:
      branch: master
      event: [ push, pull_request ]
    # Multiple steps run concurrently
    steps:
      - runScriptConfig:
          image: busybox
          shellScript: echo ${FIRST_KEY} && echo ${ALIAS_ENV}
        # Set environment variables in container for the step
        env:
          FIRST_KEY: VALUE
          SECOND_KEY: VALUE2
        # Set environment variables from project secrets
        envFrom:
          - sourceName: my-secret
            sourceKey: secret-key
            targetKey: ALIAS_ENV
      - runScriptConfig:
          image: busybox
          shellScript: date -R
        # Conditions for steps
        when:
          branch: [ master, dev ]
          event: push
  - name: Publish my image
    steps:
      - publishImageConfig:
          dockerfilePath: ./Dockerfile
          buildContext: .
          tag: rancher/rancher:v2.0.0
          # Optionally push to remote registry
          pushRemote: true
          registry: docker-registry
  - name: Deploy some workloads
    steps:
      - applyYamlConfig:
          path: ./deployment.yaml